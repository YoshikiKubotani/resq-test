# ResQ - LLMã‚’ä½¿ã£ãŸãƒ¡ãƒ¼ãƒ«è¿”ä¿¡ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ

ResQã¯ã€OpenAIã®LLMã‚’æ´»ç”¨ã—ã¦ãƒ¡ãƒ¼ãƒ«ã®è¿”ä¿¡ã‚’æ”¯æ´ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ãƒ¡ãƒ¼ãƒ«ã®å†…å®¹ã‚’åˆ†æã—ã€è¿”ä¿¡ã®ãŸã‚ã®è³ªå•ç”Ÿæˆã‚„ã€å®Ÿéš›ã®è¿”ä¿¡æ–‡ã®ç”Ÿæˆã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

## ç‰¹å¾´

- ğŸ’¬ **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªè³ªå•ç”Ÿæˆ**: ãƒ¡ãƒ¼ãƒ«ã®å†…å®¹ã‚’ç†è§£ã—ã€è¿”ä¿¡ã«å¿…è¦ãªæƒ…å ±ã‚’å¼•ãå‡ºã™ãŸã‚ã®è³ªå•ã‚’ç”Ÿæˆ
- âœï¸ **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è€ƒæ…®ã—ãŸè¿”ä¿¡ç”Ÿæˆ**: ãƒ¡ãƒ¼ãƒ«ã®æ–‡è„ˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã€é¸æŠã•ã‚ŒãŸè¿”ç­”ã‚’è€ƒæ…®ã—ãŸé©åˆ‡ãªè¿”ä¿¡ã‚’ç”Ÿæˆ
- ğŸš€ **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: ç”Ÿæˆã•ã‚ŒãŸå†…å®¹ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯Dockerã‚’ä½¿ç”¨ã—ãŸé–‹ç™ºç’°å¢ƒã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚é–‹ç™ºç’°å¢ƒã§ã¯ã€docker composeã«ã‚ˆã£ã¦ä»¥ä¸‹ã®2ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ç®¡ç†ã•ã‚Œã¾ã™ï¼š

- `applications/backend`: LLMã‚’æ´»ç”¨ã—ãŸãƒ¡ãƒ¼ãƒ«è¿”ä¿¡æ”¯æ´ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹
- `applications/chrome-extension`: Chromeæ‹¡å¼µæ©Ÿèƒ½ã¨ã—ã¦å‹•ä½œã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

å„ã‚µãƒ¼ãƒ“ã‚¹ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€`docs/`å†…ã«ã‚ã‚‹å„ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ

```
ResQ/
â”œâ”€â”€ .github/                   # GitHubé–¢é€£
â”‚   â”œâ”€â”€ ci.yaml                # ã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©
â”‚   â”œâ”€â”€ deploy.yaml            # AWS lambdaä¸Šã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©
â”‚   â””â”€â”€ terraform-reusable.yml # Terraformã«ã‚ˆã‚‹plan/applyã‚’è¡Œã†ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾© (Reusable Workflows)
â”œâ”€â”€ applications/              # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…
â”‚   â”œâ”€â”€ backend/               # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆè©³ã—ãã¯ docs/backend.md ã‚’å‚ç…§ï¼‰
â”‚   â””â”€â”€ chrome-extension/      # æ‹¡å¼µæ©Ÿèƒ½ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
â”œâ”€â”€ docs/                      # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé–¢é€£
â”œâ”€â”€ environments/              # Dockeré–¢é€£
â”‚   â”œâ”€â”€ ci/                    # CIç”¨ã®composeå®šç¾©
â”‚   â”œâ”€â”€ deploy/                # ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ã®composeå®šç¾©
â”‚   â”œâ”€â”€ dev/                   # é–‹ç™ºç”¨ã®composeå®šç¾©
â”‚   â”œâ”€â”€ Dockerfile.backend     # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç”¨ã®Dockerfile
â”‚   â”œâ”€â”€ Dockerfile.chrome      # Chromeæ‹¡å¼µç”¨ã®Dockerfile
â”‚   â””â”€â”€ Dockerfile.deploy      # ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ã®Dockerfile
â”œâ”€â”€ terraform/                 # ã‚¤ãƒ³ãƒ•ãƒ©å®šç¾©
â”‚   â”œâ”€â”€ provider.tf            # AWSãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š
â”‚   â”œâ”€â”€ variables.tf           # å¤‰æ•°å®šç¾©
â”‚   â”œâ”€â”€ main.tf                # ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹å®šç¾©
â”‚   â””â”€â”€ environments/          # ç’°å¢ƒåˆ¥è¨­å®š
â””â”€â”€ README.md
```

## é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ä»¥ä¸‹ã®æ‰‹é †ã§é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã§ãã¾ã™ï¼š

1. å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
   - Docker [ãƒªãƒ³ã‚¯](https://docs.docker.com/engine/install/)
   - Docker Compose [ãƒªãƒ³ã‚¯](https://docs.docker.com/compose/install/)

2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
   ```bash
   # é–‹ç™ºç’°å¢ƒã®ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
   cp environments/backend.env.sample environments/backend.env
   ```

   ä½œæˆã•ã‚ŒãŸ`backend.env`ã«å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã‚’æŒ‡å®šã™ã‚‹

> [!Note]
> `OPENAI_API_KEY`ã«ã¯ã€OpenAIã®[ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰](https://platform.openai.com/api-keys)ã§ç™ºè¡Œã§ãã‚‹APIã‚­ãƒ¼ã‚’æŒ‡å®šã—ã¦ä¸‹ã•ã„ã€‚
> `CORS_ALLOW_ORIGINS`ã«ã¯ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¸ã®æ¥ç¶šã‚’è¨±å®¹ã™ã‚‹ã‚ªãƒªã‚¸ãƒ³ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚

3. ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•
   ```bash
   # é–‹ç™ºç’°å¢ƒã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•
   cd environments/dev
   docker compose up -d
   ```

4. ã‚³ãƒ³ãƒ†ãƒŠã«ã‚¢ã‚¯ã‚»ã‚¹
   - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
       ```bash
       # environments/devä¸‹ã§å®Ÿè¡Œ
       docker compose exec backend bash
       ```

   - Chromeæ‹¡å¼µã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
       ```bash
       # environments/devä¸‹ã§å®Ÿè¡Œ
       docker compose exec chrome-extension bash
       ```

èµ·å‹•ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã£ãŸå¾Œã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã«ã¤ã„ã¦ã¯ã€ãã‚Œãã‚Œã®`docs`å†…ã«ã‚ã‚‹å„ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## AWS Lambda ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€GitHub Actions ã¨ Terraform ã‚’ä½¿ç”¨ã—ã¦ AWS Lambda ã¸ã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å…¬é–‹ã—ã¦ã„ã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã‚’åˆ©ç”¨ã„ãŸã ãå ´åˆã«ã¯ç‰¹ã«æ°—ã«ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã”è‡ªèº«ã§æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ”¹è‰¯ã—ã€ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã—ãŸã„å ´åˆã«ã¯ä»¥ä¸‹ã®æ‰‹é †ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

### å‰ææ¡ä»¶

1. AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™
   - AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ
   - ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨­å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ap-northeast-1ï¼‰

> [!Note]
> ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‹ã‚‰å¤‰æ›´ã™ã‚‹å ´åˆã«ã¯ã€`terraform/provider.tf`ã¨`.github/workflows/deploy.yml`ã®è©²å½“ç®‡æ‰€ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„

2. GitHub ãƒªãƒã‚¸ãƒˆãƒªã® Secrets è¨­å®š

   ä»¥ä¸‹ã® Secrets ã‚’ GitHub ãƒªãƒã‚¸ãƒˆãƒªã«è¨­å®šã—ã¦ãã ã•ã„ï¼š

   ```yaml
   # å…±é€šã®Secretsï¼ˆ[Repository Secrets](https://docs.github.com/ja/actions/security-for-github-actions/security-guides/using-secrets-in-github-actions#using-secrets-in-a-workflow) ã¨ã—ã¦è¨­å®šï¼‰
   AWS_ACCOUNT_ID: "123456789012"  # AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆID
   ALLOWED_ORIGINS: "chrome-extension://<EXTENSION_ID>, https://other.example.com, ..." # ã‚«ãƒ³ãƒã§åŒºåˆ‡ã‚‰ã‚ŒãŸã‚ªãƒªã‚¸ãƒ³
   PROJECT_NAME: "Project-Name" # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåï¼ˆAWSã®ãƒªã‚½ãƒ¼ã‚¹ã®è­˜åˆ¥å­ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ï¼‰

   # ç’°å¢ƒåˆ¥ã® Secrets ([Environment secrets](https://docs.github.com/ja/actions/security-for-github-actions/security-guides/using-secrets-in-github-actions#example-using-bash) ã¨ã—ã¦è¨­å®š)
   ## Development ç’°å¢ƒ
   LAMBDA_MEMORY: "512"
   LAMBDA_TIMEOUT: "30"

   ## Production ç’°å¢ƒ
   LAMBDA_MEMORY: "1024"
   LAMBDA_TIMEOUT: "60"
   ```

3. ãƒ–ãƒ©ãƒ³ãƒè¨­å®š
   - `develop` ãƒ–ãƒ©ãƒ³ãƒ: é–‹ç™ºç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
   - `latest` ãƒ–ãƒ©ãƒ³ãƒ: æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### ãƒ‡ãƒ—ãƒ­ã‚¤ã®å®Ÿè¡Œ

ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ä»¥ä¸‹ã®2ã¤ã®æ–¹æ³•ã§å®Ÿè¡Œã§ãã¾ã™ï¼š

1. GitHub Actionsã‚’ä½¿ç”¨ã—ãŸãƒ‡ãƒ—ãƒ­ã‚¤
   - GitHub Actions ã® "Deploy Application" ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‹ã‚‰"Run Workflows"ã‚’é¸æŠ
   - ç’°å¢ƒï¼ˆdev/prodï¼‰ã‚’é¸æŠã—ã¦å®Ÿè¡Œ

2. ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤
   - æ‰‹å‹•ã§terraform plan/applyã‚’å®Ÿè¡Œ

### ãƒ‡ãƒ—ãƒ­ã‚¤ã®æµã‚Œ

1. Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ã¨ãƒ—ãƒƒã‚·ãƒ¥
   - ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆ
   - AWS ECR ã«ãƒ—ãƒƒã‚·ãƒ¥
   - ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ã¯ `YYYYMMDD-HHMMSS-{commit_hash}` å½¢å¼

2. Terraform ã«ã‚ˆã‚‹ AWS ãƒªã‚½ãƒ¼ã‚¹ã®æ›´æ–°
   - GitHub OIDC ã«ã‚ˆã‚‹ AWS èªè¨¼
   - Lambda é–¢æ•°ã®æ›´æ–°
   - CORS è¨­å®šã®é©ç”¨

3. ãƒ‡ãƒ—ãƒ­ã‚¤çµæœã®ç¢ºèª
   - Lambda Function URL ãŒå‡ºåŠ›ã•ã‚Œã‚‹
   - CloudWatch Logs ã§ãƒ­ã‚°ã‚’ç¢ºèªå¯èƒ½

